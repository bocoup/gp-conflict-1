function makeCamps(a){var b=a[0],c=.6,d=b.append("g").attr("class","camps"),e=b.append("g").attr("class","idps"),f=b.append("g").attr("class","crossings"),g=function(a){d3.select(this).classed("selected",!0).moveToFront()},h=function(a){d3.select(this).classed("selected",!1)};return Data.getRegionGeo().then(function(b){var i=topojson.feature(b,b.objects.crossings).features,j=f.selectAll("g.crossing").data(i),k=3,l=j.enter().append("g").each(function(a){var b=path.centroid(a);d3.select(this).attr({transform:"translate("+b[0]+","+b[1]+")"})}),m=(l.append("rect").each(function(a){path.centroid(a);d3.select(this).attr({"class":"crossing marker",transform:"scale("+c+")",x:-k,width:2*k,y:-k,height:2*k})}),topojson.feature(b,b.objects.camps).features),n=d3.svg.symbol().type("triangle-up"),o=d.selectAll("g.camp").data(m),p=o.enter().append("g").attr("class","camp marker").each(function(a){var b=path.centroid(a);d3.select(this).attr({transform:"translate("+b[0]+","+b[1]+")"})}),q=p.append("path").attr("d",n).style("opacity",0).attr("transform","scale("+c+")").each(Util.tipsyIt(function(a){return'Refugee Camp: <span class="campname"><br/>'+a.properties.NAME+"</span>"})).on("mouseover",g).on("mouseout",h);Util.addOnInViewCallback(function(){q.transition().delay(function(a,b){return 50*b}).style("opacity",1)},this);var r=topojson.feature(b,b.objects.idp).features;n=d3.svg.symbol().type("triangle-down");var s=e.selectAll("g.idp").data(r),t=s.enter().append("g").each(function(a){var b=path.centroid(a);d3.select(this).attr({"class":"idp marker",transform:"translate("+b[0]+","+b[1]+")"})}),u=t.append("path").attr("d",n).style("opacity",0).attr("transform","scale("+c+")").each(Util.tipsyIt(function(a){return'Displacement Camp: <span class="campname"><br/>'+a.properties.NAME+"</span>"})).on("mouseover",g).on("mouseout",h);return Util.addOnInViewCallback(function(){u.transition().delay(function(a,b){return 50*b}).style("opacity",1)},this),Util.addOnInViewCallback(function(){var a="scale(2) translate(-16px, 65px)";Modernizr.testProp("transform")?d3.select("#map").transition().duration(2e3).delay(1e3).style({transform:a}):d3.select("#map").transition().duration(2e3).delay(1e3).styleTween("-webkit-transform",function(){return d3.interpolateString("scale(1) translate(0px,0px)",a)})},this),Promise.resolve(a)})}var path=window.path||null,makeHoverable=Promise.method(function(a){var b=a[0];return b.selectAll(".land").on("mouseover",function(a){d3.select(this).classed("selected",!0)}).on("mouseout",function(a){d3.select(this).classed("selected",!1)}),Promise.resolve(a)}),fixSizing=Promise.method(function(a){d3.select("g.capital path").attr("d","M 0.000 1.000 L 1.763 2.427 L 0.951 0.309 L 2.853 -0.927 L 0.588 -0.809 L 0.000 -3.000 L -0.588 -0.809 L -2.853 -0.927 L -0.951 0.309 L -1.763 2.427 L 0.000 1.000");var b=d3.select("g.capital text"),c=b.attr("x"),d=b.attr("y");return b.attr({x:c-4,y:d-4}),Promise.resolve(a)});Map.makeRaster("#map",imageRegionPairs.region.image,imageRegionPairs.region.geoProp,imageRegionPairs.region.geoGet).then(Map.makeToggle).then(Map.makeRegions).then(Map.makeLabels).then(Map.makeCities).then(fixSizing).then(makeCamps).then(Util.postReady);