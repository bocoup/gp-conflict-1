!function(){window.Util={preloadImage:function(a){var b=new Image;b.src=a},zeroIfNan:function(a){return isNaN(a)?0:+a},tipsyIt:function(a){return function(b){$(this).tipsy({html:!0,gravity:"e",title:function(){return a(b)}})}}};var a=[];Util.addOnInViewCallback=function(b,c,d){a.push([b,c,d])},Util.callInViewCallbacks=function(){a.forEach(function(a){a[0].call(a[1],a[2])}),a=[]},Util.postToParent=function(a,b){var c={event:a};b&&(c.value=b),parent.postMessage(c,"*")},Util.postReady=function(){Util.postToParent("ready")},d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};var b=function(a){var b=a.data;switch(b.event){case"inview":Util.callInViewCallbacks()}};window.addEventListener?window.addEventListener("message",b,!1):window.attachEvent("onmessage",b,!1)}();var path=window.path||null;window.Map={makeRaster:Promise.method(function(a,b,c,d){var e=d3.select(a).append("svg").style("background-image","url("+b+")").attr("preserveAspectRatio","xMidYMid"),f=e.append("g");return path=d3.geo.path().projection(null),Promise.resolve([f,c,d])}),makeRegions:function(a){var b=a[0],c=a[1],d=a[2];return Data[d]().then(function(a){var e=topojson.feature(a,a.objects[c]).features,f=b.selectAll("path.land").data(e);return f.enter().append("path").attr("name",function(a){return a.properties.name}).attr("class","land").attr("d",path),Promise.resolve([b,c,d])})},makeLabels:function(a){var b=a[0],c=a[1],d=a[2];return Data[d]().then(function(a){var e=topojson.feature(a,a.objects[c]).features,f=b.selectAll("text.countryname").data(e),g=["Israel","Palestine"];return f.enter().append("text").attr("class","countryname").text(function(a){return-1===g.indexOf(a.properties.NAME)?a.properties.NAME:""}).attr({x:function(a){return path.centroid(a)[0]},y:function(a){return path.centroid(a)[1]+("Jordan"===a.properties.NAME?20:0)}}),Promise.resolve([b,c,d])})},makeCities:function(a){var b=a[0],c=(a[1],a[2]),d=b.append("g").classed("cities",!0);return Data[c]().then(function(b){var c=topojson.feature(b,b.objects.cities).features,e=d.selectAll("g.city").data(c),f=3;e.enter().append("g").style("opacity",0).attr({"class":"city marker"}).attr({name:function(a){return a.properties.NAME}}).each(function(a){var b=path.centroid(a);d3.select(this).append("circle").attr({cx:b[0],cy:b[1],r:f}),d3.select(this).append("text").text(function(a){return"Dar'a"===a.properties.NAME?"daraa":a.properties.NAME.toLowerCase()}).attr({x:b[0]+2.5*f,y:b[1]+f})}),Util.addOnInViewCallback(function(){e.transition().delay(function(a,b){return 50*b}).style("opacity",1)},this);var g=topojson.feature(b,b.objects.capital).features,h=d.selectAll("g.capital").data(g);d3.svg.symbol().type("cross");return h.enter().append("g").attr("class","capital").each(function(a){var b=path.centroid(a);d3.select(this).append("path").attr({"class":"city marker",transform:"translate("+b[0]+","+b[1]+") scale(0.9)",d:"M 0.000 4.000 L 5.878 8.090 L 3.804 1.236 L 9.511 -3.090 L 2.351 -3.236 L 0.000 -10.000 L -2.351 -3.236 L -9.511 -3.090 L -3.804 1.236 L -5.878 8.090 L 0.000 4.000"}),d3.select(this).append("text").text(function(a){return a.properties.NAME}).attr({x:b[0]+4*f,y:b[1]+6})}),Util.addOnInViewCallback(function(){h.transition().style("opacity",1)},this),Promise.resolve(a)})},makeToggle:function(a){var b=!0;return $("span.icon-info2").on("click",function(a){$("#container").toggleClass("js-show-text",b).toggleClass("js-hide-text",!b),b=!b}),Promise.resolve(a)}},function(){function a(a,b){return function(){var c=Promise.defer();return d3.json(a,function(a,d){a&&c.reject(a),"undefined"!=typeof b&&(d=b(d)),c.resolve(d)}),c.promise}}window.Data={getCountryStats:a("data/stats.json",function(a){var b={},c=0,d=1/0,e=0,f=1/0;return a.forEach(function(a){var g=b[a.Destination]={Refugees_2011:Util.zeroIfNan(a.ref_2011),Refugees_2012:Util.zeroIfNan(a.ref_2012),Refugees_2013:Util.zeroIfNan(a.ref_2013),Refugees_2014:Util.zeroIfNan(a.ref_2014),Population:Util.zeroIfNan(a.pop_2014),Population_2011:Util.zeroIfNan(a.pop_2011),Population_2012:Util.zeroIfNan(a.pop_2012),Population_2013:Util.zeroIfNan(a.pop_2013),Population_2014:Util.zeroIfNan(a.pop_2014),Rate:Util.zeroIfNan(a.rate_avg)};c=Math.max(g.Refugees_2011,g.Refugees_2012,g.Refugees_2013,g.Refugees_2014,c),d=Math.min(g.Refugees_2011,g.Refugees_2012,g.Refugees_2013,g.Refugees_2014,d),e=Math.max(g.Rate,e),f=Math.min(g.Rate,f)}),{data:b,data_max:c,data_min:d,rate_max:e,rate_min:f}}),getRegionGeo:a("data/region.json"),getSyriaGeo:a("data/syria.json")}}(),window.imageRegionPairs={region:{image:"images/Region.png",geoGet:"getRegionGeo",geoProp:"region"},syria:{image:"images/Syria.png",geoGet:"getSyriaGeo",geoProp:"syria"},settling:{image:"images/Region.png",geoGet:"getRegionGeo",geoProp:"region"},turkey:{image:"images/Turkey.png",geoGet:"getTurkeyGeo",geoProp:"turkey"},lebanon:{image:"images/Lebanon.png",geoGet:"getLebanonGeo",geoProp:"lebanon"},germany:{image:"images/Germany.png",geoGet:"getGermanyGeo",geoProp:"germany"},worldRef:{image:"images/WorldReference.png"}},Util.preloadImage(imageRegionPairs.region.image),Util.preloadImage(imageRegionPairs.syria.image),Util.preloadImage(imageRegionPairs.worldRef.image);